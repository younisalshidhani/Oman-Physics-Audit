import streamlit as st
import fitz 
import google.generativeai as genai

# ุฅุนุฏุงุฏ ูุงุฌูุฉ ุงูุชุทุจูู
st.set_page_config(page_title="ุงููููู ุงูุฐูู - ุณูุทูุฉ ุนูุงู", layout="wide")
st.title("๐ก๏ธ ูุธุงู ุงูุชุฏููู ุงูุขูู ููุงุฎุชุจุงุฑุงุช (ููุฒูุงุก 12)")

with st.sidebar:
    st.header("โ๏ธ ุงูุฅุนุฏุงุฏุงุช")
    api_key = st.text_input("ุฃุฏุฎู ููุชุงุญ API ุงูุฎุงุต ุจู:", type="password")

if api_key:
    try:
        genai.configure(api_key=api_key)
        # ุงุณุชุฎุฏุงู ุงูููุฏูู ุงูุฃุญุฏุซ ุงูุฐู ุธูุฑ ูู ูุงุฆูุชู ูุถูุงู ุงูุณุฑุนุฉ ูุงูุฏูุฉ
        model = genai.GenerativeModel('gemini-2.5-flash') 
        
        uploaded_file = st.file_uploader("ุงุฑูุน ููู ุงูุงุฎุชุจุงุฑ (PDF)", type="pdf")
        
        if uploaded_file:
            with st.spinner("ุฌุงุฑู ุชุญููู ุงูููุฑุฏุงุช ูุตูุงุบุฉ ุงูุชูุฑูุฑ ุงูุฌุฏููู..."):
                doc = fitz.open(stream=uploaded_file.read(), filetype="pdf")
                text = "".join([page.get_text() for page in doc])
                
                # ุงูุจุฑููุจุช ุงููุทูุฑ ูุฅูุชุงุฌ ุฌุฏูู ุงุญุชุฑุงูู ููุฎุชุตุฑ
                prompt = f"""
                ุฃูุช ุฎุจูุฑ ุชุฑุจูู ูู ููุฒูุงุก ูุงูุจุฑูุฏุฌ ุนูุงู. ุญูู ุงูุงุฎุชุจุงุฑ ุงูุชุงูู ุจุฏูุฉ ุนุงููุฉ.
                
                ุงููุทููุจ:
                1. ุฌุฏูู Markdown ุจุงูุฃุนูุฏุฉ: (ุฑูู ุงูููุฑุฏุฉุ ุงูุฏุฑุฌุฉุ ููุน ูุฏู ุงูุชููููุ ููุน ุงูููุงุญุธุฉุ ุงูููุงุญุธุงุชุ ุงูุชุนุฏูู ุงูููุชุฑุญ).
                2. ุงูุชูุตูุฉ ุงูููุงุฆูุฉ ุงููุฎุชุตุฑุฉ (ุณุทุฑ ูุงุญุฏ).
                3. ูุณุจุฉ ูุทุงุจูุฉ ุงูุงุฎุชุจุงุฑ ูููุนุงููุฑ (%).
                
                ุงููุนุงููุฑ ุงูุตุงุฑูุฉ: 10 ุฏุฑุฌุงุช ุฅุฌูุงููุฉุ ูุญุชูู ุต 32 (ุชุฃุซูุฑ ุฏูุจูุฑ)ุ ูุฌูุฏ 4 ุจุฏุงุฆู ูููุชุนุฏุฏ.
                
                ูุต ุงูุงุฎุชุจุงุฑ:
                {text}
                """
                
                response = model.generate_content(prompt)
                st.success("โ ุชู ุงูุชุญููู ุจูุฌุงุญ!")
                st.markdown("### ๐ ุชูุฑูุฑ ุงูุชุฏููู ุงูููู ุงููุนุชูุฏ:")
                # ุนุฑุถ ุงูุฌุฏูู ูุจุงุดุฑุฉ
                st.markdown(response.text)
                
    except Exception as e:
        st.error(f"ุญุฏุซ ุฎุทุฃ ููู: {e}")
        st.info("ูุตูุญุฉ: ุชุฃูุฏ ูู ุตุญุฉ ููุชุงุญ API ูุงุฎุชูุงุฑ ุงูููุฏูู ุงูุตุญูุญ.")
else:
    st.info("ูุฑุฌู ุฅุฏุฎุงู ููุชุงุญ API ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุจุฏุก.")
