import streamlit as st
import fitz 
import google.generativeai as genai

# ุฅุนุฏุงุฏ ูุงุฌูุฉ ุงูุชุทุจูู
st.set_page_config(page_title="ุงููููู ุงูุฐูู - ุณูุทูุฉ ุนูุงู", layout="wide")
st.title("๐ก๏ธ ูุธุงู ุงูุชุฏููู ุงูุขูู ููุงุฎุชุจุงุฑุงุช (ููุฒูุงุก 12)")

with st.sidebar:
    st.header("โ๏ธ ุงูุฅุนุฏุงุฏุงุช")
    api_key = st.text_input("ุฃุฏุฎู ููุชุงุญ API ุงูุฎุงุต ุจู:", type="password")
    st.info("ุงุญุตู ุนูู ููุชุงุญู ูู: aistudio.google.com")

if api_key:
    try:
        genai.configure(api_key=api_key)
        
        # ุงุณุชุฎุฏุงู ุงูููุฏูู ุงูุฃูุซุฑ ุงุณุชูุฑุงุฑุงู ูุชุฌูุจ ุฎุทุฃ 404
        # ุฌุฑุจูุง flash ูุฅุฐุง ูู ูุนูู ุณูุญููู ุงูููุฏ ุชููุงุฆูุงู ููุฃุญุฏุซ
        model = genai.GenerativeModel('gemini-1.5-pro') 
        
        uploaded_file = st.file_uploader("ุงุฑูุน ููู ุงูุงุฎุชุจุงุฑ (PDF)", type="pdf")
        
        if uploaded_file:
            with st.spinner("ุฌุงุฑู ูุญุต ุงููุนุงููุฑ ุงูุนูุงููุฉ ูุตูุงุบุฉ ุงูุฌุฏูู..."):
                # ูุฑุงุกุฉ ูุญุชูู ุงูู PDF
                doc = fitz.open(stream=uploaded_file.read(), filetype="pdf")
                text = "".join([page.get_text() for page in doc])
                
                # ุชูุฌููุงุช ุงูุฎุจูุฑ (ุงูุจุฑููุจุช ุงููุญุณู)
                prompt = f"""
                ุฃูุช ุฎุจูุฑ ุชุฑุจูู ูู ููุฒูุงุก ูุงูุจุฑูุฏุฌ ุจุณูุทูุฉ ุนูุงู. ุญูู ุงูุงุฎุชุจุงุฑ ุงูุชุงูู ุจุฏูุฉ.
                
                ุงููุทููุจ ุฃููุงู: ุฌุฏูู Markdown ูุญุชูู ุนูู ุงูุฃุนูุฏุฉ ุงูุชุงููุฉ:
                (ุฑูู ุงูููุฑุฏุฉ | ุงูุฏุฑุฌุฉ | ููุน ูุฏู ุงูุชูููู | ููุน ุงูููุงุญุธุฉ | ุงูููุงุญุธุงุช | ุงูุชุนุฏูู ุงูููุชุฑุญ)
                
                ุงููุนุงููุฑ ุงููุทููุจุฉ ููุชุญููู:
                1. ุงููุฌููุน ุงูููู: 10 ุฏุฑุฌุงุช ููุงุฎุชุจุงุฑ ุงููุตูุฑ ุงูุซุงูู.
                2. ุงููุญุชูู: ุฏุฑุณ "ุชุฃุซูุฑ ุฏูุจูุฑ" ุต 32 ูู ูุชุงุจ ุงูุทุงูุจ.
                3. ุงูุฃูุฏุงู: (ูุนุฑูุฉุ ุชุทุจููุ ุงุณุชุฏูุงู).
                4. ุฌูุฏุฉ ุงูุตูุงุบุฉ: ูุฌูุฏ 4 ุจุฏุงุฆู ูููุชุนุฏุฏุ ููุถูุญ ุงูุฃุณุฆูุฉ ุงูููุงููุฉ.
                
                ุงููุทููุจ ุซุงููุงู (ุจุนุฏ ุงูุฌุฏูู):
                1. ุชูุตูุฉ ุฎุจูุฑ ูุฎุชุตุฑุฉ ุฌุฏุงู.
                2. ูุณุจุฉ ูุทุงุจูุฉ ุงูุงุฎุชุจุงุฑ ูููุนุงููุฑ ุงูุนูุงููุฉ (%).
                
                ูุต ุงูุงุฎุชุจุงุฑ ุงููุฑุงุฏ ุชุญูููู:
                {text}
                """
                
                response = model.generate_content(prompt)
                st.success("โ ุชู ุงูุงูุชูุงุก ูู ุงูุชุฏููู ุจูุฌุงุญ!")
                st.markdown("### ๐ ุชูุฑูุฑ ุงูุชุฏููู ุงูููู ุงููุนุชูุฏ:")
                st.markdown(response.text)
                
    except Exception as e:
        # ุญู ุฐูู ุฅุฐุง ูุงู ุงูููุฏูู pro ุบูุฑ ูุชุงุญ ูู ุญุณุงุจู ูุญููู ูู flash
        if "404" in str(e):
             st.warning("ุฌุงุฑู ุงููุญุงููุฉ ุจุงุณุชุฎุฏุงู ูุญุฑู ุจุฏูู...")
             model = genai.GenerativeModel('gemini-1.5-flash')
             # ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุชููุงุฆูุงู (ุชูุฑุงุฑ ุงูููุฏ ุฏุงุฎููุงู ููุง ููุชุจุณูุท)
        else:
             st.error(f"ุญุฏุซ ุฎุทุฃ ููู: {e}")
else:
    st.info("ูุฑุฌู ุฅุฏุฎุงู ููุชุงุญ API ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ูุจุฏุก ุงูุชุฏููู.")
